# EKI INDRADI RND 2022

FLOW
0. SETING 
- NETWORK 4. PRIVATE+NAT (CONFIG, SHARD1, SHARD2, SHARD3)
- NETWORK 1. PUBLIC IP STATIC (CLIENT)

----------- AWS VPC
INTERNET GATEWAY 
- VPC-EC2-DONT-DELETE-IGW

VPC 
- VPC-EC2-DONT-DELETE 

SUBNET
- VPC-EC2-DONT-DELETE-PUBLIC (IGW)
- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3A (IGW)
- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3B (IGW)
- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3C (IGW)
- VPC-EC2-DONT-DELETE-PRIVATE (NGW)

ROUTE TABLE
- VPC-EC2-DONT-DELETE-PUBLIC-ROUTE
--- VPC-EC2-DONT-DELETE-PUBLIC
--- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3A
--- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3B
--- VPC-EC2-DONT-DELETE-PUBLIC-JKT-3C
- VPC-EC2-DONT-DELETE-PRIVATE-ROUTE
--- VPC-EC2-DONT-DELETE-PRIVATE

NETWORK ACLS
- VPC-EC2-DONT-DELETE

ELASTIC IP
- VPC-EC2-DONT-DELETE-PRIVATE-NGW (NAT)

NAT GATEWAY
- VPC-EC2-DONT-DELETE-PRIVATE-NGW
----------- /AWS VPC

1. 10.0.1.181 DB-CLS-2GB-CFG-PRIVATE (SUBNET PRIVATE) SHARD + REPLICASET + PRIVATE+NAT NETWORK [DONE] 
- INSTAL DOCKER & COMPOSE [DONE] 
- SETUP KEYFILE [DONE] 
- INSTALL MONGODB DOCKER COMPOSE [DONE]
- SETUP SHARD REPLICASET CONFIG SERVER [DONE] 
2. 10.0.3.154 108.136.183.85 DB-CLS-2GB-CLIENT-PUBLIC (SUBNET PUBLIC JKT 3B) CONFIG + CLIENT + PUBLIC [DONE]
- INSTAL DOCKER & COMPOSE [DONE] 
- SETUP KEYFILE [DONE] 
- INSTALL MONGODB DOCKER COMPOSE [DONE]
- SETUP CLIENT SERVER (ADD CONFIG SERVER) [DONE] 
- CREATE ADMIN USER ALL PERMISSION (ALL ROOT, INCLUDE ANY DATABASE, ANY USER, ANY CLUSTER PERMISSION) [DONE] 
3. 10.0.1.28 DB-CLS-2GB-SH1-PRIVATE (SUBNET PRIVATE) SHARD + REPLICASET + PRIVATE+NAT NETWORK [DONE]
- INSTAL DOCKER & COMPOSE [DONE] 
- SETUP KEYFILE [DONE] 
- INSTALL MONGODB DOCKER COMPOSE [DONE]
- SETUP SHARD REPLICASET SHARD 1 [DONE] 
4. 10.0.1.119 DB-CLS-2GB-SH2-PRIVATE (SUBNET PRIVATE) SHARD + REPLICASET + PRIVATE+NAT NETWORK [DONE] 
- INSTAL DOCKER & COMPOSE [DONE] 
- SETUP KEYFILE [DONE] 
- INSTALL MONGODB DOCKER COMPOSE [DONE]
- SETUP SHARD REPLICASET SHARD 2 [DONE] 
5. 10.0.1.108 DB-CLS-2GB-SH3-PRIVATE (SUBNET PRIVATE) SHARD + REPLICASET + PRIVATE+NAT NETWORK [DONE] 
- INSTAL DOCKER & COMPOSE [DONE] 
- SETUP KEYFILE [DONE] 
- INSTALL MONGODB DOCKER COMPOSE [DONE]
- SETUP SHARD REPLICASET SHARD 3 [DONE] 
6. 10.0.3.154 108.136.183.85 DB-CLS-2GB-CLIENT-PUBLIC (SUBNET PUBLIC JKT 3B) CONFIG + CLIENT + PUBLIC [DONE] 
- ADD SHARD 1
- ADD SHARD 2
- ADD SHARD 3


EKI NOTE :

- reference (MONGO SHARDING BY Programmer Zaman Now) : https://www.youtube.com/watch?v=MEDzXUF-kUg 
- reference (VPC SETUP BY Preman Terminal) :  https://www.youtube.com/watch?v=R1bDcjrBk9k&list=PL3STSxysFgJi9_y7hsCEKZTN7kKdM4VoJ
- reference (VPC PEERING BY Albert Suwandhi) : https://www.youtube.com/watch?v=h9-ga_XsnGs 
- MONGO SHARDING update keyFile
- MONGO SHARDING update private network (NAT GATEWAY + PRIVATE) + setting VPC AWS + network peering Singapure + Jakarta
- MONGO SHARDING update mongodb replicaset failover (untuk autoswitch perlu tambahkan priority) , makin tinggi priority adalah yang di utamakan (tanpa arbiter)


example : 

rs.initiate(
    {
        _id: "db-1st-repset",
        members: [
            {
                _id: 0,
                host: "10.0.1.28:5001",
                priority  : 0, 
            },
            {
                _id: 1,
                host: "10.0.1.28:5002",
                priority  : 1,
            },
            {
                _id: 2,
                host: "10.0.1.28:5003",
                priority  : 2
            }
        ]
    }
)

rs.status()




# SCRIPT TESTED EKI INDRADI 2022 MONGODB V6 100% WORK